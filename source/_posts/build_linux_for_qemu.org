#+TITLE: 用 qemu-arm 构建内核开发环境
#+DATE: <2016-06-01 三> 
#+LAYOUT: post
#+CATEGORIES: 内核

  == 本博客为原创内容，欢迎转载，但请注明出处，谢谢 ==

* 准备构建环境
** 安装交叉编译器
sudo apt-get install gcc-arm-linux-guneabi
** 安装 qemu-arm 模拟器
sudo apt-get install qemu-system-arm
** 创建工作目录 
mkdir work 
cd work (work 是随便起的名字,你可以起你喜欢的名字，文章下文动作假定发生在该目录)
** 下载并解压 linux 源码
wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.6.tar.xz
tar xvf linux-4.6.tar.xz
** 下载并解压 busybox 源码
wget https://busybox.net/downloads/busybox-1.24.2.tar.bz2
tar xvf busybox-1.24.2.tar.bz2

* 编译内核
** 配置内核
进入到内核源码目录
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm vexpress_defconfig
vexpress 是 qemu 支持模拟的一种开发板，内核针对该平台编译
** 编译内核
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm
编译根据机器性能会耗费几分钟到几十分钟不等，一般情况下 20 分钟内能编译完成，请耐性等待
** 拷贝镜像
编译后的内核镜为 arch/arm/boot/下 zImage，同时 vexpress 的板设备树文件为 arch/arm/boot/dts/下，将两个文件拷贝到
根目录待用（根目录即指 work 目录，下同）
* 编译 busybox
** 配置 busybox
** 编译 busybox
** 安装 busybox

* 制作根文件系统
** 生成并格式化镜像

** 创建临时目录并挂载镜像

** 复制 busybox 文件

** 在根文件系统内创建必要的目录

** 复制系统 c 运行时库 

** 创建系统初始化脚本

** 卸载镜像（可略过）

* 用模拟器启动系统
** 写启动脚本

** 启动系统
